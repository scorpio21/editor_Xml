<?php
declare(strict_types=1);

// Internacionalización básica (es/en) para textos de la UI

/**
 * Inicializa el idioma desde ?lang=es|en y lo guarda en sesión.
 */
function i18n_init(): void {
    if (isset($_GET['lang'])) {
        $lang = $_GET['lang'];
        if ($lang === 'es' || $lang === 'en') {
            $_SESSION['lang'] = $lang;
        }
    }
    if (!isset($_SESSION['lang'])) {
        $_SESSION['lang'] = 'es';
    }
}

/**
 * Devuelve el idioma activo (es|en)
 */
function lang(): string {
    return $_SESSION['lang'] ?? 'es';
}

/**
 * Traduce una clave a partir del idioma activo.
 */
function t(string $key): string {
    static $I18N = null;
    if ($I18N === null) {
        $I18N = [
            'es' => [
                'app.title' => 'Editor XML Juegos',
                'header.title' => 'Editor de Catálogo de Juegos XML',
                'lang.label' => 'Idioma',
                'lang.es' => 'Español',
                'lang.en' => 'Inglés',
                'lang.change' => 'Cambiar',

                'tabs.welcome' => 'Bienvenida',
                'tabs.upload_search' => 'Cargar y buscar',
                'tabs.bulk_delete' => 'Eliminación masiva',
                'tabs.mame_search' => 'MAME (buscar)',
                'tabs.dedupe_region' => 'Eliminar duplicados',
                'tabs.search_external' => 'Buscar juego',

                'welcome.h2' => 'Bienvenido al editor de XML/DAT',
                'welcome.p1' => 'Esta herramienta te permite cargar, explorar, editar y mantener tu catálogo XML/DAT de juegos y máquinas.',
                'welcome.p2' => 'Usa las pestañas para navegar entre secciones. Puedes abrir la ayuda en cualquier momento.',
                'welcome.help_btn' => 'Ayuda',

                'hint.load_first' => 'Primero carga un fichero XML/DAT en la pestaña "Cargar y buscar".',
                'hint.load_first_tool' => 'Primero carga un fichero XML/DAT en la pestaña "Cargar y buscar" para usar esta herramienta.',

                'mame.h3' => 'Búsqueda en ficheros MAME',
                'mame.hint' => 'Para ficheros MAME, esta sección permite buscar máquinas por nombre, ROM o hash. La eliminación masiva está deshabilitada.',
                'mame.search_label' => 'Buscar',
                'mame.input_placeholder' => 'Nombre de máquina, ROM o hash',
                'mame.chk_roms' => 'Buscar en ROMs',
                'mame.chk_hashes' => 'Buscar en hashes (CRC/MD5/SHA1)',
                'mame.submit' => 'Buscar',
                'mame.results_hint' => 'Los resultados se muestran en la lista principal bajo el buscador.',

                'search_external.h3' => 'Buscar juego en webs externas',
                'search_external.hint' => 'Busca juegos en webs externas por nombre o por hash (MD5/SHA1/CRC). Se abrirán enlaces de búsqueda en nuevas pestañas.',
                'search_external.legend' => 'Datos de búsqueda',
                'search_external.name_label' => 'Nombre del juego',
                'search_external.name_placeholder' => 'Ej.: Super Mario World',
                'search_external.md5_label' => 'MD5',
                'search_external.md5_placeholder' => '32 hex (opcional)',
                'search_external.sha1_label' => 'SHA1',
                'search_external.sha1_placeholder' => '40 hex (opcional)',
                'search_external.crc_label' => 'CRC',
                'search_external.crc_placeholder' => '8 hex (opcional)',
                'search_external.btn_build' => 'Generar enlaces',
                'search_external.btn_open_all' => 'Abrir todas',
                'search_external.btn_check_archive' => 'Comprobar Archive',
                'search_external.links_title' => 'Enlaces de búsqueda',
                'search_external.links_hint' => 'Consejo: algunos sitios no soportan búsqueda por hash directa; por eso usamos búsquedas "site:".',
                'search_external.archive_title' => 'Archive.org',

                // Bulk delete
                'bulk.h2' => 'Eliminación masiva por filtros',
                'bulk.toggle' => 'Ocultar sección',
                'bulk.show' => 'Mostrar sección',
                'bulk.include_regions_label' => 'Regiones/países a incluir',
                'bulk.select_regions' => 'Seleccionar regiones',
                'bulk.all' => 'Todos',
                'bulk.none' => 'Ninguno',
                'bulk.exclude_langs_label' => 'Idiomas a excluir',
                'bulk.select_langs' => 'Seleccionar idiomas',
                'bulk.clear_filters' => 'Limpiar filtros',
                'bulk.reset_filters' => 'Restablecer filtros',
                'bulk.count_matches' => 'Contar coincidencias',
                'bulk.delete_filtered' => 'Eliminar filtrados',
                'bulk.confirm_delete' => '¿Seguro que deseas eliminar los juegos que coincidan con estos filtros? Esta acción no se puede deshacer.',
                'bulk.hint.lines' => 'Se buscará en nombre y descripción. Además: • en juegos (game): también en categoría. • en máquinas (machine): también en año y fabricante. Coincidencia insensible a mayúsculas/minúsculas.',
                'bulk.moved_hint' => 'La herramienta de eliminación de duplicados por región se ha movido a la pestaña "Eliminar duplicados".',

                // Dedupe by region
                'dedupe.h3' => 'Eliminar duplicados por región',
                'dedupe.hint' => 'Mantendrá solo una entrada por juego, conservando la versión de la región seleccionada (si existe). No afecta a máquinas.',
                'dedupe.label.keep_region' => 'Conservar región:',
                'dedupe.checkbox.keep_europe' => 'Conservar también Europa',
                'dedupe.checkbox.keep_europe_hint' => 'Si se marca, además de la región preferida se conservarán también las variantes de Europa.',
                'dedupe.btn.count' => 'Contar duplicados',
                'dedupe.btn.export_csv' => 'Exportar duplicados (CSV)',
                'dedupe.btn.remove' => 'Eliminar duplicados',
                'dedupe.confirm.remove' => '¿Eliminar duplicados y conservar solo la región seleccionada cuando exista?',

                // Generic JS labels
                'js.selected_suffix' => ' seleccionados',
                'js.archive.found' => 'Encontrado: ',
                'js.archive.not_found' => 'No encontrado.',
                'js.archive.view' => 'Ver en Archive',

                // Common UI
                'common.close' => 'Cerrar',
                'common.cancel' => 'Cancelar',
                'common.add' => 'Añadir',
                'common.save' => 'Guardar cambios',

                // Modal: Add game
                'add_game.title' => 'Añadir juego',
                'add_game.roms_label' => 'ROMs del juego',
                'add_game.calc_hashes' => 'Calcular hashes',
                'add_game.placeholders.rom_name' => 'Nombre de ROM',
                'add_game.placeholders.size' => 'Tamaño (bytes)',
                'add_game.placeholders.crc' => 'CRC32 (8 hex)',
                'add_game.placeholders.md5' => 'MD5 (32 hex)',
                'add_game.placeholders.sha1' => 'SHA1 (40 hex)',
                'add_game.remove_rom' => 'Eliminar ROM',
                'add_game.remove_rom_aria' => 'Eliminar esta ROM',
                'add_game.add_rom' => 'Añadir ROM',
                'add_game.name_label' => 'Nombre del juego',
                'add_game.desc_label' => 'Descripción',
                'add_game.category_label' => 'Categoría',
                'add_game.optional' => 'Opcional',
                'add_game.hint' => 'Puedes añadir múltiples ROMs. En cada fila, selecciona archivo y pulsa "Calcular hashes" para completar los campos.',

                // Modal: Create XML
                'create_xml.title' => 'Crear nuevo XML',
                'create_xml.name' => 'Nombre del catálogo',
                'create_xml.description' => 'Descripción',
                'create_xml.version' => 'Versión',
                'create_xml.date' => 'Fecha',
                'create_xml.author' => 'Autor',
                'create_xml.homepage_title' => 'Título de la web (opcional)',
                'create_xml.homepage_ph' => 'Enlace',
                'create_xml.url' => 'URL de la web (opcional)',
                'create_xml.url_ph' => 'https://ejemplo.com',
                'create_xml.submit' => 'Crear XML',

                // Modal: Edit entry
                'edit.title' => 'Editar entrada',
                'edit.name' => 'Nombre:',
                'edit.description' => 'Descripción:',
                'edit.category' => 'Categoría (solo game):',
                'edit.category_ph' => "(para 'machine' se ignora)",
                'edit.roms_legend' => 'ROMs',
                'edit.add_rom' => 'Añadir ROM',
                'edit.hashes_hint' => 'Puedes añadir, eliminar y recalcular hashes por ROM. Para calcular hashes, selecciona el archivo correspondiente.',

                // Modal: Help (titles, nav, content)
                'help.title' => 'Ayuda del Editor XML',
                'help.nav.requirements' => 'Requisitos',
                'help.nav.getting_started' => 'Primeros pasos',
                'help.nav.listing' => 'Listado y paginación',
                'help.nav.edit' => 'Edición de entradas',
                'help.nav.delete' => 'Eliminación individual',
                'help.nav.bulk' => 'Eliminación masiva',
                'help.nav.search' => 'Búsqueda',
                'help.nav.export' => 'Exportar resultados (XML)',
                'help.nav.compact' => 'Guardar / Compactar XML',
                'help.nav.restore' => 'Restaurar desde .bak',
                'help.nav.lang' => 'Idioma de la interfaz',
                'help.nav.tips' => 'Consejos y atajos',
                'help.nav.support' => 'Soporte',
                'help.back_to_index' => 'Volver al índice',
                'help.nav.aria' => 'Índice de ayuda',
                'help.s1.title' => '1) Requisitos',
                'help.s1.li1' => 'Archivo XML/DAT válido de tipo <code>datafile</code> (con cabecera y entradas).',
                'help.s1.li2' => 'PHP 8+ y extensión DOM activada en el servidor.',
                'help.s1.li3' => 'Para colecciones grandes, usa la paginación para mejorar el rendimiento.',
                'help.s2.title' => '2) Primeros pasos',
                'help.s2.ol1' => 'Ve a <strong>Subir fichero XML o DAT</strong> y selecciona tu archivo.',
                'help.s2.ol2' => 'Pulsa <strong>Cargar XML/DAT</strong>.',
                'help.s2.ol3' => 'Si es válido, se mostrará la <strong>cabecera</strong> y el <strong>listado paginado</strong>.',
                'help.s2.security' => 'Seguridad: si el archivo contiene una declaración <code>&lt;!DOCTYPE ...&gt;</code>, el editor la <strong>eliminará automáticamente</strong> por seguridad (mitigación XXE) y guardará el XML saneado. Se mostrará un aviso solo la primera vez.',
                'help.s2.tip' => 'Consejo: tras cambios masivos, usa <em>Guardar / Compactar XML</em> para mantener el archivo limpio.',
                'help.s3.title' => '3) Listado y paginación',
                'help.s3.li1' => 'Navega con <strong>Anterior / Siguiente</strong> o el formulario <strong>Ir a</strong>.',
                'help.s3.li2' => 'Configura <strong>Elementos por página</strong> (10/25/50/100) según tu preferencia.',
                'help.s3.li3' => 'La vista unifica <code>&lt;game&gt;</code> y <code>&lt;machine&gt;</code> para una navegación consistente.',
                'help.s4.title' => '4) Edición de entradas',
                'help.s4.ol1' => 'Pulsa <strong>Editar</strong> en la tarjeta de la entrada.',
                'help.s4.ol2' => 'Actualiza los campos y confirma con <strong>Guardar cambios</strong>.',
                'help.s4.ol3' => '<strong>Multi‑ROM</strong>: puedes añadir, eliminar o modificar varias ROMs en la misma entrada.',
                'help.s4.ol4' => 'Validaciones: <code>size</code> numérico, <code>crc</code> (8 hex), <code>md5</code> (32 hex), <code>sha1</code> (40 hex). Puedes calcular MD5/SHA1 desde fichero.',
                'help.s4.ol5' => 'En <code>machine</code> se muestran además <strong>year</strong> y <strong>manufacturer</strong>. El campo <code>category</code> aplica solo a <code>game</code>.',
                'help.s4.note' => 'Al guardar, el XML se reescribe con formato consistente e indentación adecuada.',
                'help.s5.title' => '5) Eliminación individual',
                'help.s5.ol1' => 'Pulsa <strong>Eliminar</strong> en la entrada (juego o máquina) y confirma la acción.',
                'help.s5.ol2' => 'Se crea automáticamente una copia <code>.bak</code> antes de escribir cambios.',
                'help.s5.note' => '<strong>Nota:</strong> en ficheros <strong>MAME</strong> la eliminación individual está <strong>deshabilitada</strong>. Solo se permite buscar y editar.',
                'help.s6.title' => '6) Eliminación masiva',
                'help.s6.ol1' => 'Define <em>Regiones/países a incluir</em> y <em>Idiomas a excluir</em>.',
                'help.s6.ol2a' => 'La búsqueda contempla <strong>juegos y máquinas</strong>:',
                'help.s6.ol2b1' => 'Juegos: <code>name</code>, <code>description</code>, <code>category</code>.',
                'help.s6.ol2b2' => 'Máquinas: <code>name</code>, <code>description</code>, <code>year</code>, <code>manufacturer</code>.',
                'help.s6.ol3' => 'Usa <strong>Contar coincidencias</strong> para previsualizar el impacto (no borra nada).',
                'help.s6.ol4' => 'Si estás conforme, pulsa <strong>Eliminar filtrados</strong>.',
                'help.s6.note' => '<strong>Importante:</strong> la eliminación masiva <strong>no está disponible</strong> para ficheros <strong>MAME</strong>.',
                'help.s7.title' => '7) Búsqueda',
                'help.s7.li1' => '<strong>Índice</strong>:',
                'help.s7.li2' => '<em>Búsqueda general</em>: filtra por <strong>nombre</strong>, <strong>descripción</strong> y <strong>categoría</strong> antes de paginar. El término se conserva al navegar entre páginas o cambiar "Mostrar N".',
                'help.s7.li3' => '<em>MAME (buscar)</em>: buscador específico por <strong>nombre</strong>, <strong>ROM</strong> y <strong>hash</strong>. No hay eliminación masiva ni botones de eliminar.',
                'help.s7.li4' => '<em>Buscar juego (externo)</em>: genera enlaces de búsqueda en <strong>myrient</strong>, <strong>vimm</strong> y <strong>archive.org</strong> por nombre y hashes (MD5/SHA1/CRC). Opción <strong>"Comprobar Archive"</strong> para consultar su API y mostrar un enlace directo cuando hay coincidencias.',
                'help.s8.title' => '8) Exportar resultados (XML)',
                'help.s8.li1' => 'Tras aplicar filtros o una búsqueda, pulsa <strong>Exportar resultados (XML)</strong> para descargar un archivo solo con las entradas mostradas (sin duplicados).',
                'help.s8.li2' => 'El nombre del archivo se sanea para Windows y el contenido textual se escapa correctamente para evitar errores de entidades XML.',
                'help.s9.title' => '9) Guardar / Compactar XML',
                'help.s9.li1' => 'Reescribe el fichero con indentación consistente y sin líneas en blanco entre elementos.',
                'help.s9.li2' => 'Recomendado tras operaciones masivas para mantener el XML ordenado.',
                'help.s10.title' => '10) Restaurar desde .bak',
                'help.s10.li1' => 'Usa el botón <strong>Restaurar desde .bak</strong> para volver al estado anterior si algo no salió como esperabas.',
                'help.s11.title' => '11) Idioma de la interfaz',
                'help.s11.li1' => 'Usa las banderas <strong>ES/EN</strong> en la cabecera para alternar el idioma de la interfaz.',
                'help.s11.li2' => 'El estado se recuerda durante la sesión del navegador.',
                'help.s12.title' => '12) Consejos y atajos',
                'help.s12.li1' => 'Para colecciones grandes, reduce los elementos por página para una navegación fluida.',
                'help.s12.li2' => 'Si detectas espacios o líneas en blanco, ejecuta <strong>Guardar / Compactar XML</strong>.',
                'help.s12.li3' => 'Si la sesión expira o el navegador bloquea cookies, vuelve a cargar la página y reintenta.',
                'help.s12.kb_title' => '<strong>Atajos de teclado (Pestañas)</strong>:',
                'help.s12.kb_li1' => '<kbd>Flecha derecha</kbd>/<kbd>Flecha izquierda</kbd>: mover el foco a la pestaña siguiente/anterior.',
                'help.s12.kb_li2' => '<kbd>Home</kbd>/<kbd>End</kbd>: saltar a la primera/última pestaña.',
                'help.s12.kb_li3' => '<kbd>Enter</kbd> o <kbd>Espacio</kbd>: activar la pestaña enfocada.',
                'help.s13.title' => '13) Soporte',
                'help.s13.li1' => 'Consulta el <strong>README</strong> y el <strong>CHANGELOG</strong> para detalles técnicos y novedades.',
                'help.s13.li2' => '¿Dudas o problemas? Abre un Issue: <a href="https://github.com/scorpio21/editor_Xml/issues/new/choose" target="_blank" rel="noopener">Crear issue en GitHub</a>.',

                // Search external (JS)
                'js.se.md5_invalid' => 'MD5 debe tener 32 caracteres hexadecimales.',
                'js.se.sha1_invalid' => 'SHA1 debe tener 40 caracteres hexadecimales.',
                'js.se.crc_invalid' => 'CRC debe tener 8 caracteres hexadecimales.',
                'js.se.require_one' => 'Introduce al menos un dato: Nombre, MD5, SHA1 o CRC.',
                'js.se.no_links' => 'No se generaron enlaces.',
                'js.se.invalid_response' => 'Respuesta no válida.',
                'js.se.no_response' => 'Sin respuesta',
                'js.se.already_running' => 'Ya hay una comprobación en curso…',
                'js.se.wait_seconds' => 'Espera {s}s para volver a intentar.',
                'js.se.checking' => 'Comprobando…',
                'js.se.too_many' => 'Demasiadas solicitudes. Intenta más tarde.',
                'js.se.could_not_query' => 'No se pudo consultar Archive.',
                'js.se.could_not_query_org' => 'No se pudo consultar Archive.org.',

                // Games list & search
                'games_list.h2' => 'Lista de juegos/máquinas',
                'search.label' => 'Buscar',
                'search.placeholder' => 'Nombre (juego/máquina), ROM o hash',
                'search.in_roms' => 'Buscar en ROMs',
                'search.in_hashes' => 'Buscar en hashes (CRC/MD5/SHA1)',
                'search.button' => 'Buscar',
                'export_xml.button' => 'Exportar resultados (XML)',
                'export_xml.hint' => 'Exporta los resultados actuales, sin duplicados, en un nuevo XML.',
                'per_page.label' => 'Mostrar',
                'per_page.apply' => 'Aplicar',
                'header_file.h2' => 'Cabecera del fichero',
                'header.name' => 'Nombre:',
                'header.description' => 'Descripción:',
                'header.version' => 'Versión:',
                'header.date' => 'Fecha:',
                'header.author' => 'Autor:',
                'header.web' => 'Web:',
                'header.link' => 'Enlace',
                'header.na' => 'N/A',
                'header.none' => 'No hay información de cabecera disponible',
                'list.showing.prefix' => 'Mostrando',
                'list.of' => 'de',
                'item.type' => 'Tipo:',
                'item.type.game' => 'juego',
                'item.type.machine' => 'máquina',
                'item.name' => 'Nombre:',
                'item.description' => 'Descripción:',
                'item.year' => 'Año:',
                'item.manufacturer' => 'Fabricante:',
                'item.category' => 'Categoría:',
                'roms.title' => 'ROMs:',
                'roms.name' => 'Nombre:',
                'roms.size' => 'Tamaño:',
                'roms.crc' => 'CRC:',
                'roms.md5' => 'MD5:',
                'roms.sha1' => 'SHA1:',
                'roms.na' => 'N/A',
                'actions.edit' => 'Editar',
                'actions.delete' => 'Eliminar',
                'confirm.delete.game' => '¿Eliminar este juego?',
                'confirm.delete.machine' => '¿Eliminar esta máquina?',
                'pagination.prev' => 'Anterior',
                'pagination.next' => 'Siguiente',
                'pagination.page' => 'Página',
                'pagination.of' => 'de',
                'pagination.goto.label' => 'Ir a',
                'pagination.goto.button' => 'Ir',
            ],
            'en' => [
                'app.title' => 'XML Games Editor',
                'header.title' => 'XML Games Catalog Editor',
                'lang.label' => 'Language',
                'lang.es' => 'Spanish',
                'lang.en' => 'English',
                'lang.change' => 'Change',

                'tabs.welcome' => 'Welcome',
                'tabs.upload_search' => 'Load and search',
                'tabs.bulk_delete' => 'Bulk delete',
                'tabs.mame_search' => 'MAME (search)',
                'tabs.dedupe_region' => 'Remove duplicates',
                'tabs.search_external' => 'Search game',

                'welcome.h2' => 'Welcome to the XML/DAT editor',
                'welcome.p1' => 'This tool lets you load, explore, edit and maintain your XML/DAT catalog of games and machines.',
                'welcome.p2' => 'Use the tabs to navigate across sections. You can open the help at any time.',
                'welcome.help_btn' => 'Help',

                'hint.load_first' => 'First load an XML/DAT file in the "Load and search" tab.',
                'hint.load_first_tool' => 'First load an XML/DAT file in the "Load and search" tab to use this tool.',

                'mame.h3' => 'Search in MAME files',
                'mame.hint' => 'For MAME files, this section allows searching machines by name, ROM or hash. Bulk delete is disabled.',
                'mame.search_label' => 'Search',
                'mame.input_placeholder' => 'Machine name, ROM or hash',
                'mame.chk_roms' => 'Search in ROMs',
                'mame.chk_hashes' => 'Search in hashes (CRC/MD5/SHA1)',
                'mame.submit' => 'Search',
                'mame.results_hint' => 'Results are shown in the main list below the search box.',

                'search_external.h3' => 'Search game on external websites',
                'search_external.hint' => 'Search games on external websites by name or by hash (MD5/SHA1/CRC). Links will open in new tabs.',
                'search_external.legend' => 'Search data',
                'search_external.name_label' => 'Game name',
                'search_external.name_placeholder' => 'E.g.: Super Mario World',
                'search_external.md5_label' => 'MD5',
                'search_external.md5_placeholder' => '32 hex (optional)',
                'search_external.sha1_label' => 'SHA1',
                'search_external.sha1_placeholder' => '40 hex (optional)',
                'search_external.crc_label' => 'CRC',
                'search_external.crc_placeholder' => '8 hex (optional)',
                'search_external.btn_build' => 'Generate links',
                'search_external.btn_open_all' => 'Open all',
                'search_external.btn_check_archive' => 'Check Archive',
                'search_external.links_title' => 'Search links',
                'search_external.links_hint' => 'Tip: some sites don\'t support direct hash search; that\'s why we use "site:" searches.',
                'search_external.archive_title' => 'Archive.org',

                // Bulk delete
                'bulk.h2' => 'Bulk delete by filters',
                'bulk.toggle' => 'Hide section',
                'bulk.show' => 'Show section',
                'bulk.include_regions_label' => 'Regions/countries to include',
                'bulk.select_regions' => 'Select regions',
                'bulk.all' => 'All',
                'bulk.none' => 'None',
                'bulk.exclude_langs_label' => 'Languages to exclude',
                'bulk.select_langs' => 'Select languages',
                'bulk.clear_filters' => 'Clear filters',
                'bulk.reset_filters' => 'Reset filters',
                'bulk.count_matches' => 'Count matches',
                'bulk.delete_filtered' => 'Delete filtered',
                'bulk.confirm_delete' => 'Are you sure you want to delete the games that match these filters? This action cannot be undone.',
                'bulk.hint.lines' => 'It will search in name and description. Additionally: • in games: also in category. • in machines: also in year and manufacturer. Case-insensitive matching.',
                'bulk.moved_hint' => 'The tool to remove duplicates by region has moved to the "Remove duplicates" tab.',

                // Dedupe by region
                'dedupe.h3' => 'Remove duplicates by region',
                'dedupe.hint' => 'Keeps only one entry per game, preserving the selected region version (if it exists). Does not affect machines.',
                'dedupe.label.keep_region' => 'Keep region:',
                'dedupe.checkbox.keep_europe' => 'Also keep Europe',
                'dedupe.checkbox.keep_europe_hint' => 'If checked, in addition to the preferred region it will also keep Europe variants.',
                'dedupe.btn.count' => 'Count duplicates',
                'dedupe.btn.export_csv' => 'Export duplicates (CSV)',
                'dedupe.btn.remove' => 'Remove duplicates',
                'dedupe.confirm.remove' => 'Remove duplicates and keep only the selected region when available?',

                // Generic JS labels
                'js.selected_suffix' => ' selected',
                'js.archive.found' => 'Found: ',
                'js.archive.not_found' => 'Not found.',
                'js.archive.view' => 'View on Archive',

                // Common UI
                'common.close' => 'Close',
                'common.cancel' => 'Cancel',
                'common.add' => 'Add',
                'common.save' => 'Save changes',

                // Modal: Add game
                'add_game.title' => 'Add game',
                'add_game.roms_label' => 'Game ROMs',
                'add_game.calc_hashes' => 'Calculate hashes',
                'add_game.placeholders.rom_name' => 'ROM name',
                'add_game.placeholders.size' => 'Size (bytes)',
                'add_game.placeholders.crc' => 'CRC32 (8 hex)',
                'add_game.placeholders.md5' => 'MD5 (32 hex)',
                'add_game.placeholders.sha1' => 'SHA1 (40 hex)',
                'add_game.remove_rom' => 'Remove ROM',
                'add_game.remove_rom_aria' => 'Remove this ROM',
                'add_game.add_rom' => 'Add ROM',
                'add_game.name_label' => 'Game name',
                'add_game.desc_label' => 'Description',
                'add_game.category_label' => 'Category',
                'add_game.optional' => 'Optional',
                'add_game.hint' => 'You can add multiple ROMs. In each row, select a file and click "Calculate hashes" to fill the fields.',

                // Modal: Create XML
                'create_xml.title' => 'Create new XML',
                'create_xml.name' => 'Catalog name',
                'create_xml.description' => 'Description',
                'create_xml.version' => 'Version',
                'create_xml.date' => 'Date',
                'create_xml.author' => 'Author',
                'create_xml.homepage_title' => 'Website title (optional)',
                'create_xml.homepage_ph' => 'Link',
                'create_xml.url' => 'Website URL (optional)',
                'create_xml.url_ph' => 'https://example.com',
                'create_xml.submit' => 'Create XML',

                // Modal: Edit entry
                'edit.title' => 'Edit entry',
                'edit.name' => 'Name:',
                'edit.description' => 'Description:',
                'edit.category' => 'Category (game only):',
                'edit.category_ph' => "(ignored for 'machine')",
                'edit.roms_legend' => 'ROMs',
                'edit.add_rom' => 'Add ROM',
                'edit.hashes_hint' => 'You can add, remove and recalculate hashes per ROM. To calculate hashes, select the corresponding file.',

                // Modal: Help (titles, nav, content)
                'help.title' => 'XML Editor Help',
                'help.nav.requirements' => 'Requirements',
                'help.nav.getting_started' => 'Getting started',
                'help.nav.listing' => 'Listing & pagination',
                'help.nav.edit' => 'Editing entries',
                'help.nav.delete' => 'Individual deletion',
                'help.nav.bulk' => 'Bulk delete',
                'help.nav.search' => 'Search',
                'help.nav.export' => 'Export results (XML)',
                'help.nav.compact' => 'Save / Compact XML',
                'help.nav.restore' => 'Restore from .bak',
                'help.nav.lang' => 'Interface language',
                'help.nav.tips' => 'Tips & shortcuts',
                'help.nav.support' => 'Support',
                'help.back_to_index' => 'Back to index',
                'help.nav.aria' => 'Help index',
                'help.s1.title' => '1) Requirements',
                'help.s1.li1' => 'Valid XML/DAT file of type <code>datafile</code> (with header and entries).',
                'help.s1.li2' => 'PHP 8+ and DOM extension enabled on the server.',
                'help.s1.li3' => 'For large collections, use pagination to improve performance.',
                'help.s2.title' => '2) Getting started',
                'help.s2.ol1' => 'Go to <strong>Upload XML or DAT file</strong> and select your file.',
                'help.s2.ol2' => 'Click <strong>Load XML/DAT</strong>.',
                'help.s2.ol3' => 'If valid, the <strong>header</strong> and the <strong>paginated list</strong> will be displayed.',
                'help.s2.security' => 'Security: if the file contains a <code>&lt;!DOCTYPE ...&gt;</code> declaration, the editor will <strong>remove it automatically</strong> for security (XXE mitigation) and save a sanitized XML. A notice is shown only the first time.',
                'help.s2.tip' => 'Tip: after massive changes, use <em>Save / Compact XML</em> to keep the file clean.',
                'help.s3.title' => '3) Listing & pagination',
                'help.s3.li1' => 'Navigate with <strong>Previous / Next</strong> or the <strong>Go to</strong> form.',
                'help.s3.li2' => 'Set <strong>Items per page</strong> (10/25/50/100) as you prefer.',
                'help.s3.li3' => 'The view unifies <code>&lt;game&gt;</code> and <code>&lt;machine&gt;</code> for consistent browsing.',
                'help.s4.title' => '4) Editing entries',
                'help.s4.ol1' => 'Click <strong>Edit</strong> on the entry card.',
                'help.s4.ol2' => 'Update fields and confirm with <strong>Save changes</strong>.',
                'help.s4.ol3' => '<strong>Multi‑ROM</strong>: you can add, remove or modify several ROMs in the same entry.',
                'help.s4.ol4' => 'Validations: numeric <code>size</code>, <code>crc</code> (8 hex), <code>md5</code> (32 hex), <code>sha1</code> (40 hex). You can calculate MD5/SHA1 from file.',
                'help.s4.ol5' => 'For <code>machine</code>, <strong>year</strong> and <strong>manufacturer</strong> are also shown. The <code>category</code> field applies only to <code>game</code>.',
                'help.s4.note' => 'When saving, the XML is rewritten with consistent formatting and proper indentation.',
                'help.s5.title' => '5) Individual deletion',
                'help.s5.ol1' => 'Click <strong>Delete</strong> on the entry (game or machine) and confirm the action.',
                'help.s5.ol2' => 'A <code>.bak</code> copy is automatically created before writing changes.',
                'help.s5.note' => '<strong>Note:</strong> in <strong>MAME</strong> files, individual deletion is <strong>disabled</strong>. Only search and edit are allowed.',
                'help.s6.title' => '6) Bulk delete',
                'help.s6.ol1' => 'Define <em>Regions/countries to include</em> and <em>Languages to exclude</em>.',
                'help.s6.ol2a' => 'The search considers <strong>games and machines</strong>:',
                'help.s6.ol2b1' => 'Games: <code>name</code>, <code>description</code>, <code>category</code>.',
                'help.s6.ol2b2' => 'Machines: <code>name</code>, <code>description</code>, <code>year</code>, <code>manufacturer</code>.',
                'help.s6.ol3' => 'Use <strong>Count matches</strong> to preview the impact (does not delete anything).',
                'help.s6.ol4' => 'If you agree, click <strong>Delete filtered</strong>.',
                'help.s6.note' => '<strong>Important:</strong> bulk delete is <strong>not available</strong> for <strong>MAME</strong> files.',
                'help.s7.title' => '7) Search',
                'help.s7.li1' => '<strong>Index</strong>:',
                'help.s7.li2' => '<em>General search</em>: filters by <strong>name</strong>, <strong>description</strong> and <strong>category</strong> before paginating. The term is preserved when navigating between pages or changing "Show N".',
                'help.s7.li3' => '<em>MAME (search)</em>: specific search by <strong>name</strong>, <strong>ROM</strong> and <strong>hash</strong>. There is no bulk delete nor delete buttons.',
                'help.s7.li4' => '<em>Search game (external)</em>: generates search links in <strong>myrient</strong>, <strong>vimm</strong> and <strong>archive.org</strong> by name and hashes (MD5/SHA1/CRC). "<strong>Check Archive</strong>" option to call its API and show a direct link when there are matches.',
                'help.s8.title' => '8) Export results (XML)',
                'help.s8.li1' => 'After applying filters or a search, click <strong>Export results (XML)</strong> to download a file with only the displayed entries (without duplicates).',
                'help.s8.li2' => 'The filename is sanitized for Windows and text content is properly escaped to avoid XML entity errors.',
                'help.s9.title' => '9) Save / Compact XML',
                'help.s9.li1' => 'Rewrites the file with consistent indentation and without blank lines between elements.',
                'help.s9.li2' => 'Recommended after bulk operations to keep the XML tidy.',
                'help.s10.title' => '10) Restore from .bak',
                'help.s10.li1' => 'Use the <strong>Restore from .bak</strong> button to go back to the previous state if something didn’t work as expected.',
                'help.s11.title' => '11) Interface language',
                'help.s11.li1' => 'Use the <strong>ES/EN</strong> flags in the header to toggle the interface language.',
                'help.s11.li2' => 'The state is remembered during the browser session.',
                'help.s12.title' => '12) Tips & shortcuts',
                'help.s12.li1' => 'For large collections, reduce items per page for smooth navigation.',
                'help.s12.li2' => 'If you detect spaces or blank lines, run <strong>Save / Compact XML</strong>.',
                'help.s12.li3' => 'If the session expires or the browser blocks cookies, reload the page and try again.',
                'help.s12.kb_title' => '<strong>Keyboard shortcuts (Tabs)</strong>:',
                'help.s12.kb_li1' => '<kbd>Right arrow</kbd>/<kbd>Left arrow</kbd>: move focus to next/previous tab.',
                'help.s12.kb_li2' => '<kbd>Home</kbd>/<kbd>End</kbd>: jump to first/last tab.',
                'help.s12.kb_li3' => '<kbd>Enter</kbd> or <kbd>Space</kbd>: activate the focused tab.',
                'help.s13.title' => '13) Support',
                'help.s13.li1' => 'Check the <strong>README</strong> and <strong>CHANGELOG</strong> for technical details and news.',
                'help.s13.li2' => 'Questions or issues? Open an Issue: <a href="https://github.com/scorpio21/editor_Xml/issues/new/choose" target="_blank" rel="noopener">Create issue on GitHub</a>.',

                // Search external (JS)
                'js.se.md5_invalid' => 'MD5 must be 32 hexadecimal characters.',
                'js.se.sha1_invalid' => 'SHA1 must be 40 hexadecimal characters.',
                'js.se.crc_invalid' => 'CRC must be 8 hexadecimal characters.',
                'js.se.require_one' => 'Enter at least one: Name, MD5, SHA1 or CRC.',
                'js.se.no_links' => 'No links were generated.',
                'js.se.invalid_response' => 'Invalid response.',
                'js.se.no_response' => 'No response',
                'js.se.already_running' => 'A check is already in progress…',
                'js.se.wait_seconds' => 'Wait {s}s to try again.',
                'js.se.checking' => 'Checking…',
                'js.se.too_many' => 'Too many requests. Try again later.',
                'js.se.could_not_query' => 'Could not query Archive.',
                'js.se.could_not_query_org' => 'Could not query Archive.org.',

                // Games list & search
                'games_list.h2' => 'Games/Machines list',
                'search.label' => 'Search',
                'search.placeholder' => 'Name (game/machine), ROM or hash',
                'search.in_roms' => 'Search in ROMs',
                'search.in_hashes' => 'Search in hashes (CRC/MD5/SHA1)',
                'search.button' => 'Search',
                'export_xml.button' => 'Export filtered results (XML)',
                'export_xml.hint' => 'Exports current results, without duplicates, into a new XML.',
                'per_page.label' => 'Show',
                'per_page.apply' => 'Apply',
                'header_file.h2' => 'File header',
                'header.name' => 'Name:',
                'header.description' => 'Description:',
                'header.version' => 'Version:',
                'header.date' => 'Date:',
                'header.author' => 'Author:',
                'header.web' => 'Website:',
                'header.link' => 'Link',
                'header.na' => 'N/A',
                'header.none' => 'No header information available',
                'list.showing.prefix' => 'Showing',
                'list.of' => 'of',
                'item.type' => 'Type:',
                'item.type.game' => 'game',
                'item.type.machine' => 'machine',
                'item.name' => 'Name:',
                'item.description' => 'Description:',
                'item.year' => 'Year:',
                'item.manufacturer' => 'Manufacturer:',
                'item.category' => 'Category:',
                'roms.title' => 'ROMs:',
                'roms.name' => 'Name:',
                'roms.size' => 'Size:',
                'roms.crc' => 'CRC:',
                'roms.md5' => 'MD5:',
                'roms.sha1' => 'SHA1:',
                'roms.na' => 'N/A',
                'actions.edit' => 'Edit',
                'actions.delete' => 'Delete',
                'confirm.delete.game' => 'Delete this game?',
                'confirm.delete.machine' => 'Delete this machine?',
                'pagination.prev' => 'Previous',
                'pagination.next' => 'Next',
                'pagination.page' => 'Page',
                'pagination.of' => 'of',
                'pagination.goto.label' => 'Go to',
                'pagination.goto.button' => 'Go',
            ],
        ];
    }
    return $I18N[lang()][$key] ?? $key;
}
